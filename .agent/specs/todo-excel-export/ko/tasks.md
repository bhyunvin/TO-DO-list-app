# 구현 계획

- [x] 1. exceljs 의존성 설치
  - 백엔드(src 디렉토리)에 exceljs 패키지 설치
  - package.json을 확인하여 설치 확인
  - _요구사항: 1.1_

- [x] 2. 백엔드 Excel 내보내기 서비스 메서드 구현
  - [x] 2.1 TodoService에 exportToExcel 메서드 추가
    - userSeq, startDate 및 endDate 매개변수를 허용하는 메서드 시그니처 생성
    - 날짜 범위 및 del_yn = 'N'으로 필터링된 todo를 가져오는 데이터베이스 쿼리 구현
    - todoDate 및 todoSeq를 오름차순으로 결과 정렬
    - _요구사항: 1.3, 1.4, 3.1, 3.2, 3.3, 3.4, 3.5_
  
  - [x] 2.2 Excel 통합 문서 생성 로직 구현
    - exceljs를 사용하여 새 통합 문서 및 워크시트 생성
    - 열 너비 구성(A: 0, B: 4, C: 80, D: 15, E: 90)
    - 사양에 따라 열 A 및 행 1을 비워 둠
    - _요구사항: 2.1, 2.2, 2.6_
  
  - [x] 2.3 스타일링으로 헤더 행 추가
    - 셀 B2:E2에 헤더 텍스트 설정(번호, 내용, 완료일시, 비고)
    - 헤더 범위에 연한 회색 배경 채우기(#D3D3D3) 적용
    - 헤더 셀의 모든 면에 테두리 적용
    - 헤더에 굵은 글꼴 및 가운데 정렬 적용
    - _요구사항: 2.3, 2.4, 2.5_
  
  - [x] 2.4 데이터 행 채우기
    - 행 3부터 필터링된 todo를 반복
    - todo.seq를 열 B에 매핑
    - todo.todoContent를 열 C에 매핑
    - "YYYY-MM-DD HH:mm" 형식으로 todo.completeDtm을 열 D에 매핑
    - todo.todoNote를 열 E에 매핑
    - completeDtm 및 todoNote에 대한 null 값 처리(빈 문자열 표시)
    - _요구사항: 3.1, 3.2, 3.3, 3.4, 3.5_
  
  - [x] 2.5 Excel 버퍼 생성 및 반환
    - 통합 문서를 버퍼에 쓰기
    - 컨트롤러가 응답으로 전송할 버퍼 반환
    - _요구사항: 1.5_

- [x] 3. 백엔드 Excel 내보내기 컨트롤러 엔드포인트 구현
  - [x] 3.1 TodoController에 exportToExcel 엔드포인트 추가
    - /api/todo/excel에 GET 엔드포인트 생성
    - 인증을 위한 AuthenticatedGuard 적용
    - 쿼리 매개변수에서 startDate 및 endDate 추출
    - 세션에서 userSeq 추출
    - _요구사항: 1.1, 1.2_
  
  - [x] 3.2 입력 유효성 검사 및 오류 처리 추가
    - startDate 및 endDate가 제공되었는지 유효성 검사
    - 날짜 형식(YYYY-MM-DD) 유효성 검사
    - 잘못된 입력에 대해 400 Bad Request 반환
    - 서비스 오류 처리 및 500 Internal Server Error 반환
    - _요구사항: 1.1, 1.2_
  
  - [x] 3.3 응답 헤더 구성 및 파일 전송
    - Content-Type을 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'로 설정
    - 파일 이름 패턴 "todos_YYYY-MM-DD_to_YYYY-MM-DD.xlsx"로 Content-Disposition 설정
    - Excel 버퍼를 응답으로 전송
    - _요구사항: 1.5_

- [x] 4. 프론트엔드 Excel 내보내기 버튼 구현
  - [x] 4.1 TodoContainer에 Excel 내보내기 버튼 추가
    - "신규" 버튼 왼쪽에 위치한 todo-actions div에 버튼 추가
    - btn btn-outline-success 스타일링 적용
    - 버튼 텍스트를 "Excel" 또는 "Excel 내보내기"로 설정
    - 접근성을 위한 aria-label 추가
    - 생성/편집/프로필 모드가 아닐 때만 버튼 표시
    - _요구사항: 4.1, 4.2, 4.3, 4.4_

- [x] 5. 프론트엔드 날짜 범위 선택 모달 구현
  - [x] 5.1 날짜 범위 모달 함수 생성
    - 두 개의 날짜 입력 필드로 SweetAlert2 모달 구현
    - 모바일 호환성을 위해 날짜 선택기를 세로로 스택
    - 기본값을 현재 월의 첫째 날과 마지막 날로 설정
    - "시작일"(Start Date) 및 "종료일"(End Date)에 대한 레이블 추가
    - _요구사항: 5.1, 5.2, 5.3, 5.4_
  
  - [x] 5.2 날짜 유효성 검사 로직 추가
    - 두 날짜가 모두 선택되었는지 유효성 검사
    - startDate가 endDate 이후가 아닌지 유효성 검사
    - 모달에 인라인 유효성 검사 메시지 표시
    - 유효성 검사가 실패하면 모달 확인 방지
    - _요구사항: 5.1, 5.2, 5.3, 5.4_

- [x] 6. 프론트엔드 Excel 내보내기 및 다운로드 핸들러 구현
  - [x] 6.1 handleExcelExport 함수 생성
    - 버튼 클릭 시 날짜 범위 모달 트리거
    - 선택한 startDate 및 endDate를 쿼리 매개변수로 백엔드 API 호출
    - API 응답 처리 및 blob으로 변환
    - _요구사항: 5.5, 5.6_
  
  - [x] 6.2 파일 다운로드 로직 구현
    - blob에서 객체 URL 생성
    - 다운로드를 위한 임시 앵커 요소 생성
    - 날짜 범위 패턴으로 다운로드 파일 이름 설정
    - 다운로드 트리거 및 리소스 정리
    - SweetAlert를 사용하여 성공 메시지 표시
    - _요구사항: 5.5, 5.6_
  
  - [x] 6.3 오류 처리 추가
    - 사용자 친화적인 메시지로 네트워크 오류 처리
    - API 오류(400, 401, 500) 처리
    - SweetAlert를 사용하여 오류 메시지 표시
    - _요구사항: 5.5, 5.6_

- [x] 7. 백엔드 단위 테스트 추가
  - [x] 7.1 TodoService.exportToExcel 테스트 작성
    - 유효한 데이터로 성공적인 Excel 생성 테스트
    - 빈 결과 집합 처리 테스트
    - 날짜 범위 필터링 정확도 테스트
    - del_yn = 'N' 필터링 테스트
    - Excel 셀의 날짜 형식 지정 테스트(YYYY-MM-DD HH:mm)
    - completeDtm 및 todoNote에 대한 null 값 처리 테스트
    - _요구사항: 1.3, 1.4, 3.1, 3.2, 3.3, 3.4, 3.5_
  
  - [x] 7.2 TodoController.exportToExcel 테스트 작성
    - 올바른 헤더로 성공적인 응답 테스트
    - 인증 가드 적용 테스트
    - 쿼리 매개변수 유효성 검사 테스트
    - 잘못된 입력에 대한 오류 응답 형식 지정 테스트
    - _요구사항: 1.1, 1.2, 1.5_

- [x] 8. 프론트엔드 컴포넌트 테스트 추가
  - [x] 8.1 Excel 내보내기 버튼 렌더링 테스트
    - 버튼이 올바른 위치에 렌더링되는지 테스트
    - 버튼 스타일링 테스트(btn-outline-success)
    - 다양한 모드에서 버튼 가시성 테스트
    - _요구사항: 4.1, 4.2, 4.3, 4.4_
  
  - [x] 8.2 날짜 범위 모달 기능 테스트
    - 모달이 날짜 선택기와 함께 표시되는지 테스트
    - 날짜 유효성 검사 로직 테스트
    - 취소 버튼 동작 테스트
    - 유효한 날짜로 확인 버튼 테스트
    - _요구사항: 5.1, 5.2, 5.3, 5.4_
  
  - [x] 8.3 파일 다운로드 핸들러 테스트
    - 성공적인 다운로드 흐름 테스트
    - 네트워크 실패에 대한 오류 처리 테스트
    - 파일 이름 지정 규칙 테스트
    - _요구사항: 5.5, 5.6_
